<div class='span8 well'>

<% if @course.subscribed_courses.any? and (@course.subscribed_courses.select {|x| x.user_id == session[:user].id}).any? %>
<% @subscribed_courses = @course.subscribed_courses.select {|x| x.user_id == session[:user].id} %>
  <%= link_to "[Unsubscribe]", unsubscribe_path(@subscribed_courses), method: 'delete'%>
<% else %>
  <%= link_to "[Subscribe]", subscribe_path(@course), method: 'post' %>
<% end %>

<h4><%= @course.name %></h4>

<p class="quiet"> <%= @course.department %> | <%= @course.number %> </p>

</div>
<div class="span8 well">

<%= render 'shared/errors', obj: @post %>

<% if @course.subscribed_courses.any? and (@course.subscribed_courses.select {|x| x.user_id == session[:user].id}).any? %>

<%= form_for [@course, @post] do |f| %>

<div class="control-group">
<%= f.label :title %>
<%= f.text_field :title %>
</div>

<div class="control-group">
<%= f.label :description %>
<%= f.text_area :description, rows: 5 %>
</div>

<div class='control-group'>
  <%= f.file_field :photo %>
</div>

<div class="control-group">
<%= f.submit "Create Post", class: "btn btn-success" %>
</div>

<% end %>
</div>

<% @course.posts.reload.each do |post| %>
  <%= link_to course_post_path(params[:id], post.id) do %>
  <div class="span8 well">
    <h4><%= post.title %></h4>
    <% @image_url = "uploads/post/photo/#{post.id}" %>
    <%= image_tag post.photo_url() %>
    <p><%= post.description %></p>
    <p class="small quiet">created at <%= datetime(post.created_at) %> by <%= post.user.username %></p>
  </div>
  <% end %>
<% end %>

<% if @course.posts.empty? %>
  <div class="span8 well">
    <h3>There aren't any posts yet!</h3>
  </div>
  <% else %>
  <% end %>

  <% else %>

  <div class="span8 well">
    <h5>You need to subscribe to participate in this course.</h5>
  </div>

  <% end %>